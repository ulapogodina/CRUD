// Класс для управления каталогом машин
class CarCatalog {
    private cars: Car[] = [];
    private nextId: number = 1;

    // Create - создание новой машины
    addCar(newCar: NewCar): Car {
        const car: Car = {
            id: this.nextId++,
            ...newCar
        };
        this.cars.push(car);
        return car;
    }

    // Read - чтение всех машин
    getAllCars(): Car[] {
        return [...this.cars];
    }

    // Read - поиск машины по ID
    getCarById(id: number): Car | undefined {
        return this.cars.find(car => car.id === id);
    }

    // Read - поиск машин по фильтрам
    searchCars(filters: Partial<NewCar>): Car[] {
        return this.cars.filter(car => {
            return Object.entries(filters).every(([key, value]) => {
                if (key === 'isUsed') {
                    return car.isUsed === value;
                }
                if (key === 'year') {
                    return car.year === value;
                }
                if (key === 'price') {
                    return car.price <= (value as number);
                }
                return car[key as keyof NewCar] === value;
            });
        });
    }

    // Update - обновление машины
    updateCar(updateData: CarUpdate): Car | undefined {
        const index = this.cars.findIndex(car => car.id === updateData.id);
        
        if (index === -1) {
            return undefined;
        }

        const updatedCar = {
            ...this.cars[index],
            ...updateData
        };

        this.cars[index] = updatedCar;
        return updatedCar;
    }

    // Delete - удаление машины
    deleteCar(id: number): boolean {
        const initialLength = this.cars.length;
        this.cars = this.cars.filter(car => car.id !== id);
        return this.cars.length < initialLength;
    }

    // Получение статистики
    getStatistics(): {
        totalCars: number;
        newCars: number;
        usedCars: number;
        averagePrice: number;
        minYear: number;
        maxYear: number;
    } {
        if (this.cars.length === 0) {
            return {
                totalCars: 0,
                newCars: 0,
                usedCars: 0,
                averagePrice: 0,
                minYear: 0,
                maxYear: 0
            };
        }

        const usedCars = this.cars.filter(car => car.isUsed).length;
        const totalPrice = this.cars.reduce((sum, car) => sum + car.price, 0);
        const years = this.cars.map(car => car.year);

        return {
            totalCars: this.cars.length,
            newCars: this.cars.length - usedCars,
            usedCars: usedCars,
            averagePrice: Math.round(totalPrice / this.cars.length),
            minYear: Math.min(...years),
            maxYear: Math.max(...years)
        };
    }

    // Очистка каталога
    clearCatalog(): void {
        this.cars = [];
        this.nextId = 1;
    }
}
