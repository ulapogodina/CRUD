import * as readline from 'readline';

// –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
export interface Car {
    id: number;
    manufacturer: string;
    model: string;
    year: number;
    isUsed: boolean;
    price: number;
}

// –¢–∏–ø –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –º–∞—à–∏–Ω—ã (–±–µ–∑ ID)
export type NewCar = Omit<Car, 'id'>;

// –¢–∏–ø –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—à–∏–Ω—ã (–≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –∫—Ä–æ–º–µ ID)
export type CarUpdate = Partial<Omit<Car, 'id'>> & { id: number };

// –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º –º–∞—à–∏–Ω
export class CarCatalog {
    private cars: Car[] = [];
    private nextId: number = 1;

    // Create - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∞—à–∏–Ω—ã
    addCar(newCar: NewCar): Car {
        const car: Car = {
            id: this.nextId++,
            ...newCar
        };
        this.cars.push(car);
        return car;
    }

    // Read - —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞—à–∏–Ω
    getAllCars(): Car[] {
        return [...this.cars];
    }

    // Read - –ø–æ–∏—Å–∫ –º–∞—à–∏–Ω—ã –ø–æ ID
    getCarById(id: number): Car | undefined {
        return this.cars.find(car => car.id === id);
    }

    // Read - –ø–æ–∏—Å–∫ –º–∞—à–∏–Ω –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º
    searchCars(filters: Partial<NewCar>): Car[] {
        return this.cars.filter(car => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
            for (const [key, value] of Object.entries(filters)) {
                if (value === undefined || value === '') {
                    continue;
                }

                switch (key) {
                    case 'manufacturer':
                        if (typeof value === 'string' && 
                            !car.manufacturer.toLowerCase().includes(value.toLowerCase())) {
                            return false;
                        }
                        break;
                        
                    case 'model':
                        if (typeof value === 'string' && 
                            !car.model.toLowerCase().includes(value.toLowerCase())) {
                            return false;
                        }
                        break;
                        
                    case 'year':
                        if (car.year !== value) {
                            return false;
                        }
                        break;
                        
                    case 'isUsed':
                        if (car.isUsed !== value) {
                            return false;
                        }
                        break;
                        
                    case 'price':
                        if (car.price > (value as number)) {
                            return false;
                        }
                        break;
                }
            }
            return true;
        });
    }

    // Update - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
    updateCar(updateData: CarUpdate): Car | undefined {
        const index = this.cars.findIndex(car => car.id === updateData.id);
        
        if (index === -1) {
            return undefined;
        }

        // –£–¥–∞–ª—è–µ–º id –∏–∑ updateData —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å
        const { id, ...updates } = updateData;
        const updatedCar = {
            ...this.cars[index],
            ...updates
        };

        this.cars[index] = updatedCar;
        return updatedCar;
    }

    // Delete - —É–¥–∞–ª–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
    deleteCar(id: number): boolean {
        const initialLength = this.cars.length;
        this.cars = this.cars.filter(car => car.id !== id);
        return this.cars.length < initialLength;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    getStatistics(): {
        totalCars: number;
        newCars: number;
        usedCars: number;
        averagePrice: number;
        minYear: number;
        maxYear: number;
    } {
        if (this.cars.length === 0) {
            return {
                totalCars: 0,
                newCars: 0,
                usedCars: 0,
                averagePrice: 0,
                minYear: 0,
                maxYear: 0
            };
        }

        const usedCars = this.cars.filter(car => car.isUsed).length;
        const totalPrice = this.cars.reduce((sum, car) => sum + car.price, 0);
        const years = this.cars.map(car => car.year);

        return {
            totalCars: this.cars.length,
            newCars: this.cars.length - usedCars,
            usedCars: usedCars,
            averagePrice: Math.round(totalPrice / this.cars.length),
            minYear: Math.min(...years),
            maxYear: Math.max(...years)
        };
    }

    // –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
    clearCatalog(): void {
        this.cars = [];
        this.nextId = 1;
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    addDemoData(): void {
        const demoData: NewCar[] = [
            {
                manufacturer: 'Toyota',
                model: 'Camry',
                year: 2022,
                isUsed: false,
                price: 30000
            },
            {
                manufacturer: 'BMW',
                model: 'X5',
                year: 2020,
                isUsed: true,
                price: 45000
            },
            {
                manufacturer: 'Mercedes',
                model: 'C-Class',
                year: 2023,
                isUsed: false,
                price: 55000
            },
            {
                manufacturer: 'Honda',
                model: 'Civic',
                year: 2019,
                isUsed: true,
                price: 20000
            },
            {
                manufacturer: 'Tesla',
                model: 'Model 3',
                year: 2021,
                isUsed: true,
                price: 35000
            }
        ];

        demoData.forEach(car => this.addCar(car));
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Å–æ–ª—å—é
export class ConsoleInterface {
    private rl: readline.Interface;
    private catalog: CarCatalog;

    constructor() {
        this.rl = readline.createInterface({
            input: process.stdin,
            output: process.stdout
        });
        this.catalog = new CarCatalog();
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é
    private displayMenu(): void {
        console.clear();
        console.log('\n=== üöó –ö–ê–¢–ê–õ–û–ì –ú–ê–®–ò–ù ===');
        console.log('1. –î–æ–±–∞–≤–∏—Ç—å –º–∞—à–∏–Ω—É');
        console.log('2. –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∞—à–∏–Ω—ã');
        console.log('3. –ù–∞–π—Ç–∏ –º–∞—à–∏–Ω—É –ø–æ ID');
        console.log('4. –ü–æ–∏—Å–∫ –º–∞—à–∏–Ω –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º');
        console.log('5. –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—à–∏–Ω–µ');
        console.log('6. –£–¥–∞–ª–∏—Ç—å –º–∞—à–∏–Ω—É');
        console.log('7. –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É');
        console.log('8. –û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥');
        console.log('9. –î–æ–±–∞–≤–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ');
        console.log('0. –í—ã–π—Ç–∏');
    }

    // –ó–∞–ø—Ä–æ—Å –≤–≤–æ–¥–∞
    private askQuestion(question: string): Promise<string> {
        return new Promise((resolve) => {
            this.rl.question(question, (answer) => {
                resolve(answer);
            });
        });
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –º–∞—à–∏–Ω—ã
    private displayCar(car: Car): void {
        console.log('\n' + '‚ïê'.repeat(40));
        console.log(`üÜî ID: ${car.id}`);
        console.log(`üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ${car.manufacturer}`);
        console.log(`üöò –ú–æ–¥–µ–ª—å: ${car.model}`);
        console.log(`üìÖ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ${car.year}`);
        console.log(`üîß –°–æ—Å—Ç–æ—è–Ω–∏–µ: ${car.isUsed ? '–ë/–£' : '–ù–æ–≤–∞—è'}`);
        console.log(`üí∞ –¶–µ–Ω–∞: $${car.price.toLocaleString('ru-RU')}`);
        console.log('‚ïê'.repeat(40));
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ–¥–∞
    private isValidYear(year: number): boolean {
        const currentYear = new Date().getFullYear();
        return !isNaN(year) && year >= 1900 && year <= currentYear + 1;
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
    private async addCar(): Promise<void> {
        console.log('\n=== üÜï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–ô –ú–ê–®–ò–ù–´ ===');

        try {
            const manufacturer = await this.askQuestion('üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ');
            if (!manufacturer.trim()) {
                console.log('‚ùå –û—à–∏–±–∫–∞: –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const model = await this.askQuestion('üöò –ú–æ–¥–µ–ª—å: ');
            if (!model.trim()) {
                console.log('‚ùå –û—à–∏–±–∫–∞: –º–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π!');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const yearStr = await this.askQuestion('üìÖ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ');
            const year = parseInt(yearStr);
            if (!this.isValidYear(year)) {
                console.log(`‚ùå –û—à–∏–±–∫–∞: –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ (1900-${new Date().getFullYear() + 1})!`);
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const isUsedInput = await this.askQuestion('üîß –°–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–æ–≤–∞—è/–±—É): ');
            const isUsed = isUsedInput.toLowerCase() === '–±—É' || 
                          isUsedInput.toLowerCase() === '–±/—É' ||
                          isUsedInput.toLowerCase() === 'used' ||
                          isUsedInput.toLowerCase() === 'true';

            const priceStr = await this.askQuestion('üí∞ –¶–µ–Ω–∞ ($): ');
            const price = parseFloat(priceStr);
            if (isNaN(price) || price <= 0 || price > 10000000) {
                console.log('‚ùå –û—à–∏–±–∫–∞: —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º (–¥–æ 10,000,000)!');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const newCar: NewCar = {
                manufacturer: manufacturer.trim(),
                model: model.trim(),
                year,
                isUsed,
                price
            };

            const car = this.catalog.addCar(newCar);
            console.log('\n‚úÖ –ú–∞—à–∏–Ω–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞:');
            this.displayCar(car);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–∞—à–∏–Ω—ã:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∞—à–∏–Ω—ã
    private async showAllCars(): Promise<void> {
        const cars = this.catalog.getAllCars();
        
        if (cars.length === 0) {
            console.log('\nüì≠ –ö–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç.');
        } else {
            console.log(`\n=== üìã –í–°–ï –ú–ê–®–ò–ù–´ (${cars.length}) ===`);
            cars.forEach(car => this.displayCar(car));
        }
        await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
    }

    // –ü–æ–∏—Å–∫ –ø–æ ID
    private async findCarById(): Promise<void> {
        try {
            const idStr = await this.askQuestion('üîç –í–≤–µ–¥–∏—Ç–µ ID –º–∞—à–∏–Ω—ã: ');
            const id = parseInt(idStr);
            
            if (isNaN(id) || id <= 0) {
                console.log('‚ùå –û—à–∏–±–∫–∞: ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const car = this.catalog.getCarById(id);
            
            if (car) {
                this.displayCar(car);
            } else {
                console.log(`\n‚ùå –ú–∞—à–∏–Ω–∞ —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.`);
            }
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –º–∞—à–∏–Ω—ã:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –ü–æ–∏—Å–∫ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º
    private async searchCars(): Promise<void> {
        console.log('\n=== üîç –ü–û–ò–°–ö –ú–ê–®–ò–ù ===');
        console.log('(–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –Ω–µ –Ω—É–∂–µ–Ω)');

        try {
            const manufacturer = await this.askQuestion('üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ');
            const model = await this.askQuestion('üöò –ú–æ–¥–µ–ª—å: ');
            const yearInput = await this.askQuestion('üìÖ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ');
            const isUsedInput = await this.askQuestion('üîß –°–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–æ–≤–∞—è/–±—É): ');
            const maxPriceInput = await this.askQuestion('üí∞ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ ($): ');

            const filters: Partial<NewCar> = {};
            
            if (manufacturer.trim()) {
                filters.manufacturer = manufacturer.trim();
            }
            if (model.trim()) {
                filters.model = model.trim();
            }
            if (yearInput.trim()) {
                const year = parseInt(yearInput);
                if (this.isValidYear(year)) {
                    filters.year = year;
                }
            }
            if (isUsedInput.trim()) {
                filters.isUsed = isUsedInput.toLowerCase() === '–±—É' || 
                               isUsedInput.toLowerCase() === '–±/—É' ||
                               isUsedInput.toLowerCase() === 'used' ||
                               isUsedInput.toLowerCase() === 'true';
            }
            if (maxPriceInput.trim()) {
                const maxPrice = parseFloat(maxPriceInput);
                if (!isNaN(maxPrice) && maxPrice > 0) {
                    filters.price = maxPrice;
                }
            }

            const results = this.catalog.searchCars(filters);
            
            if (results.length === 0) {
                console.log('\n‚ùå –ú–∞—à–∏–Ω—ã –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
            } else {
                console.log(`\n=== ‚úÖ –ù–ê–ô–î–ï–ù–û –ú–ê–®–ò–ù: ${results.length} ===`);
                results.forEach(car => this.displayCar(car));
            }
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
    private async updateCar(): Promise<void> {
        console.log('\n=== ‚úèÔ∏è –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –ú–ê–®–ò–ù–ï ===');
        
        try {
            const idStr = await this.askQuestion('–í–≤–µ–¥–∏—Ç–µ ID –º–∞—à–∏–Ω—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ');
            const id = parseInt(idStr);
            
            if (isNaN(id) || id <= 0) {
                console.log('‚ùå –û—à–∏–±–∫–∞: ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const existingCar = this.catalog.getCarById(id);
            if (!existingCar) {
                console.log(`\n‚ùå –ú–∞—à–∏–Ω–∞ —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.`);
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            console.log('\nüìã –¢–µ–∫—É—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—à–∏–Ω–µ:');
            this.displayCar(existingCar);
            console.log('\n‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ):');

            const manufacturer = await this.askQuestion(`üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å [${existingCar.manufacturer}]: `);
            const model = await this.askQuestion(`üöò –ú–æ–¥–µ–ª—å [${existingCar.model}]: `);
            const yearInput = await this.askQuestion(`üìÖ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ [${existingCar.year}]: `);
            const isUsedInput = await this.askQuestion(`üîß –°–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–æ–≤–∞—è/–±—É) [${existingCar.isUsed ? '–±—É' : '–Ω–æ–≤–∞—è'}]: `);
            const priceInput = await this.askQuestion(`üí∞ –¶–µ–Ω–∞ [${existingCar.price}]: `);

            const updateData: CarUpdate = { id };

            if (manufacturer.trim()) {
                updateData.manufacturer = manufacturer.trim();
            }
            if (model.trim()) {
                updateData.model = model.trim();
            }
            if (yearInput.trim()) {
                const year = parseInt(yearInput);
                if (this.isValidYear(year)) {
                    updateData.year = year;
                }
            }
            if (isUsedInput.trim()) {
                updateData.isUsed = isUsedInput.toLowerCase() === '–±—É' || 
                                  isUsedInput.toLowerCase() === '–±/—É' ||
                                  isUsedInput.toLowerCase() === 'used' ||
                                  isUsedInput.toLowerCase() === 'true';
            }
            if (priceInput.trim()) {
                const price = parseFloat(priceInput);
                if (!isNaN(price) && price > 0 && price <= 10000000) {
                    updateData.price = price;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —á—Ç–æ –æ–±–Ω–æ–≤–ª—è—Ç—å
            const hasUpdates = Object.keys(updateData).length > 1; // –ë–æ–ª—å—à–µ 1, –ø–æ—Ç–æ–º—É —á—Ç–æ id –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å
            
            if (hasUpdates) {
                const updatedCar = this.catalog.updateCar(updateData);
                if (updatedCar) {
                    console.log('\n‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:');
                    this.displayCar(updatedCar);
                }
            } else {
                console.log('\n‚ÑπÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –≤–Ω–µ—Å–µ–Ω–æ.');
            }
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–∞—à–∏–Ω—ã:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
    private async deleteCar(): Promise<void> {
        try {
            const idStr = await this.askQuestion('üóëÔ∏è –í–≤–µ–¥–∏—Ç–µ ID –º–∞—à–∏–Ω—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: ');
            const id = parseInt(idStr);
            
            if (isNaN(id) || id <= 0) {
                console.log('‚ùå –û—à–∏–±–∫–∞: ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            const car = this.catalog.getCarById(id);
            if (!car) {
                console.log(`\n‚ùå –ú–∞—à–∏–Ω–∞ —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.`);
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            console.log('\n‚ö†Ô∏è –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å:');
            this.displayCar(car);
            
            const confirm = await this.askQuestion('\n‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã? (–¥–∞/–Ω–µ—Ç): ');
            
            if (confirm.toLowerCase() === '–¥–∞') {
                const success = this.catalog.deleteCar(id);
                
                if (success) {
                    console.log(`\n‚úÖ –ú–∞—à–∏–Ω–∞ —Å ID ${id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.`);
                }
            } else {
                console.log('\n‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.');
            }
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–∞—à–∏–Ω—ã:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    private async showStatistics(): Promise<void> {
        const stats = this.catalog.getStatistics();
        
        console.log('\n=== üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–ê–¢–ê–õ–û–ì–ê ===');
        console.log(`üìà –í—Å–µ–≥–æ –º–∞—à–∏–Ω: ${stats.totalCars}`);
        console.log(`üÜï –ù–æ–≤—ã—Ö: ${stats.newCars}`);
        console.log(`üîß –ë/–£: ${stats.usedCars}`);
        console.log(`üí∞ –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: $${stats.averagePrice.toLocaleString('ru-RU')}`);
        
        if (stats.totalCars > 0) {
            console.log(`üìÖ –î–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤: ${stats.minYear} - ${stats.maxYear}`);
        }
        await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
    }

    // –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
    private async clearCatalog(): Promise<void> {
        try {
            const stats = this.catalog.getStatistics();
            if (stats.totalCars === 0) {
                console.log('\n‚ÑπÔ∏è –ö–∞—Ç–∞–ª–æ–≥ —É–∂–µ –ø—É—Å—Ç.');
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                return;
            }

            console.log(`\n‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´? –í—Å–µ –¥–∞–Ω–Ω—ã–µ (${stats.totalCars} –º–∞—à–∏–Ω) –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!`);
            const confirm = await this.askQuestion('–í–≤–µ–¥–∏—Ç–µ "–£–î–ê–õ–ò–¢–¨" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ');
            
            if (confirm === '–£–î–ê–õ–ò–¢–¨') {
                this.catalog.clearCatalog();
                console.log('‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –æ—á–∏—â–µ–Ω.');
            } else {
                console.log('‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.');
            }
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∫–∞—Ç–∞–ª–æ–≥–∞:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
    private async addDemoData(): Promise<void> {
        try {
            const existingCars = this.catalog.getAllCars();
            if (existingCars.length > 0) {
                const confirm = await this.askQuestion('\n‚ö†Ô∏è –í –∫–∞—Ç–∞–ª–æ–≥–µ —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ. –î–æ–±–∞–≤–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ? (–¥–∞/–Ω–µ—Ç): ');
                if (confirm.toLowerCase() !== '–¥–∞') {
                    console.log('‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.');
                    await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                    return;
                }
            }

            this.catalog.addDemoData();
            const newCount = this.catalog.getAllCars().length - existingCars.length;
            console.log(`\n‚úÖ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã! –î–æ–±–∞–≤–ª–µ–Ω–æ ${newCount} –º–∞—à–∏–Ω.`);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö:', error);
            await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
        }
    }

    // –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    public async run(): Promise<void> {
        console.clear();
        console.log('üöó –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º –º–∞—à–∏–Ω!');
        
        let running = true;
        
        while (running) {
            try {
                this.displayMenu();
                const choice = await this.askQuestion('\nüéØ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (0-9): ');

                switch (choice) {
                    case '1':
                        await this.addCar();
                        break;
                    case '2':
                        await this.showAllCars();
                        break;
                    case '3':
                        await this.findCarById();
                        break;
                    case '4':
                        await this.searchCars();
                        break;
                    case '5':
                        await this.updateCar();
                        break;
                    case '6':
                        await this.deleteCar();
                        break;
                    case '7':
                        await this.showStatistics();
                        break;
                    case '8':
                        await this.clearCatalog();
                        break;
                    case '9':
                        await this.addDemoData();
                        break;
                    case '0':
                        console.log('\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
                        running = false;
                        break;
                    default:
                        console.log('\n‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                        await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
                }
            } catch (error) {
                console.log('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞:', error);
                await this.askQuestion('\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...');
            }
        }
        
        this.close();
    }

    public close(): void {
        this.rl.close();
    }
}
